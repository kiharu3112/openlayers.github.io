"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[962],{30867:function(e,t,r){var s=r(41564),i=r(87240),a=r(66401),l=r(53815),n=r(88887),o=r(22685),h=r(16235),_=r(74717),c=r(12911),m=r(9466),p=r(77163),f=r(77801),u=r(2732),T=r(54976),d=r(84333),E=r(4666),M=r(14049);class b extends M.A{constructor(e,t){super(e),this.batch_=new d.A,this.styleRenderers_=t,this.buffers=[],this.maskVertices=new p.Ay(E.H7,E.Ek),this.setTile(e.tile)}generateMaskBuffer_(){const e=this.tile.getSourceTiles()[0].extent;this.maskVertices.fromArray([e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]]),this.helper.flushBufferData(this.maskVertices)}uploadTile(){this.generateMaskBuffer_(),this.batch_.clear();const e=this.tile.getSourceTiles(),t=e.reduce(((e,t)=>e.concat(t.getFeatures())),[]);this.batch_.addFeatures(t);const r=e[0].extent[0],s=e[0].extent[1],i=(0,c.Tl)((0,c.vt)(),-r,-s),a=this.styleRenderers_.map(((e,t)=>e.generateBuffers(this.batch_,i).then((e=>{this.buffers[t]=e}))));Promise.all(a).then((()=>{this.setReady()}))}}var k=b,g=r(50823),y=r(55721);const A={...y.gF,TILE_MASK_TEXTURE:"u_depthMask",TILE_ZOOM_LEVEL:"u_tileZoomLevel"},L="a_position";class R extends y.Ay{constructor(e,t){super(e,{cacheSize:t.cacheSize,uniforms:{[A.PATTERN_ORIGIN]:[0,0],[A.TILE_MASK_TEXTURE]:()=>this.tileMaskTarget_.getTexture()}}),this.hitDetectionEnabled_=!t.disableHitDetection,this.styles_=[],this.styleVariables_=t.variables||{},this.styleRenderers_=[],this.currentFrameStateTransform_=(0,c.vt)(),this.tmpTransform_=(0,c.vt)(),this.tmpMat4_=(0,m.vt)(),this.tileMaskTarget_=null,this.tileMaskIndices_=new p.Ay(E.IP,E.Ek),this.tileMaskIndices_.fromArray([0,1,3,1,2,3]),this.tileMaskAttributes_=[{name:L,size:2,type:f.jQ.FLOAT}],this.tileMaskProgram_,this.applyOptions_(t)}reset(e){super.reset(e),this.applyOptions_(e),this.helper&&(this.createRenderers_(),this.initTileMask_())}applyOptions_(e){this.styles_=Array.isArray(e.style)?e.style:[e.style]}createRenderers_(){function e(e){const t=e.getFragmentDiscardExpression(),r=`texture2D(${A.TILE_MASK_TEXTURE}, gl_FragCoord.xy / u_pixelRatio / u_viewportSizePx).r * 50. > ${A.TILE_ZOOM_LEVEL} + 0.5`;e.setFragmentDiscardExpression("false"!==t?`(${t}) || (${r})`:r),e.addUniform(`sampler2D ${A.TILE_MASK_TEXTURE}`),e.addUniform(`float ${A.TILE_ZOOM_LEVEL}`)}this.styleRenderers_=this.styles_.map((t=>{let r;if("builder"in t)e(t.builder),r=t;else{const s=(0,g.my)(t,this.styleVariables_);e(s.builder),r={builder:s.builder,attributes:s.attributes,uniforms:s.uniforms}}return new _.A(r,this.styleVariables_,this.helper,this.hitDetectionEnabled_)}))}initTileMask_(){this.tileMaskTarget_=new u.A(this.helper);const e=(new T.N).setFillColorExpression(`vec4(${A.TILE_ZOOM_LEVEL} / 50., 0., 0., 1.)`).addUniform(`float ${A.TILE_ZOOM_LEVEL}`);this.tileMaskProgram_=this.helper.getProgram(e.getFillFragmentShader(),e.getFillVertexShader()),this.helper.flushBufferData(this.tileMaskIndices_)}afterHelperCreated(){this.createRenderers_(),this.initTileMask_()}createTileRepresentation(e){const t=new k(e,this.styleRenderers_),r=()=>{t.ready&&(this.getLayer().changed(),t.removeEventListener(o.A.CHANGE,r))};return t.addEventListener(o.A.CHANGE,r),t}beforeTilesRender(e,t){super.beforeTilesRender(e,!0),this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_)}beforeTilesMaskRender(e){this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_);const t=e.pixelRatio,r=e.size;return this.tileMaskTarget_.setSize([r[0]*t,r[1]*t]),this.helper.prepareDrawToRenderTarget(e,this.tileMaskTarget_,!0,!0),this.helper.useProgram(this.tileMaskProgram_,e),(0,c.k3)(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(A.PROJECTION_MATRIX,(0,m.Z1)(this.tmpMat4_,this.tmpTransform_)),(0,c.T9)(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(A.SCREEN_TO_WORLD_MATRIX,(0,m.Z1)(this.tmpMat4_,this.tmpTransform_)),!0}renderTileMask(e,t,r,s){if(!e.ready)return;this.helper.setUniformFloatValue(A.DEPTH,s),this.helper.setUniformFloatValue(A.TILE_ZOOM_LEVEL,t),this.helper.setUniformFloatVec4(A.RENDER_EXTENT,r),this.helper.setUniformFloatValue(A.GLOBAL_ALPHA,1),this.helper.bindBuffer(e.maskVertices),this.helper.bindBuffer(this.tileMaskIndices_),this.helper.enableAttributes(this.tileMaskAttributes_);const i=this.tileMaskIndices_.getSize();this.helper.drawElements(0,i)}applyUniforms_(e,t,r,s,i){(0,c.k3)(this.tmpTransform_,this.currentFrameStateTransform_),(0,c.lw)(this.tmpTransform_,r),this.helper.setUniformMatrixValue(A.PROJECTION_MATRIX,(0,m.Z1)(this.tmpMat4_,this.tmpTransform_)),(0,c.T9)(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(A.SCREEN_TO_WORLD_MATRIX,(0,m.Z1)(this.tmpMat4_,this.tmpTransform_)),this.helper.setUniformFloatValue(A.GLOBAL_ALPHA,e),this.helper.setUniformFloatValue(A.DEPTH,i),this.helper.setUniformFloatValue(A.TILE_ZOOM_LEVEL,s),this.helper.setUniformFloatVec4(A.RENDER_EXTENT,t)}renderTile(e,t,r,s,i,a,l,n,o,_,c){const m=(0,h._N)(n,s,n),p=e.tile.getTileCoord()[0];for(let t=0,s=this.styleRenderers_.length;t<s;t++){const s=this.styleRenderers_[t],i=e.buffers[t];s.render(i,r,(()=>{this.applyUniforms_(c,m,i.invertVerticesTransform,p,o)}))}}renderDeclutter(e){}disposeInternal(){super.disposeInternal()}}var S=R,V=r(98267),I=r(38276),O=r(75052),w=r(44689),x=r(88292),F=r(59194);const v=(0,g.my)({"fill-color":["get","fillColor"],"stroke-color":["get","strokeColor"],"stroke-width":["get","strokeWidth"],"circle-radius":4,"circle-fill-color":"#777"});class U extends n.A{createRenderer(){return new S(this,{style:{builder:v.builder,attributes:{fillColor:{size:2,callback:e=>{const t=this.getStyle()(e,1)[0],r=(0,a._j)(t?.getFill()?.getColor()||"#eee");return(0,g.l3)(r)}},strokeColor:{size:2,callback:e=>{const t=this.getStyle()(e,1)[0],r=(0,a._j)(t?.getStroke()?.getColor()||"#eee");return(0,g.l3)(r)}},strokeWidth:{size:1,callback:e=>{const t=this.getStyle()(e,1)[0];return t?.getStroke()?.getWidth()||0}}}}})}}new s.A({layers:[new U({source:new V.A({attributions:'© <a href="https://www.mapbox.com/map-feedback/">Mapbox</a> © <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>',format:new l.A,url:"https://{a-d}.tiles.mapbox.com/v4/mapbox.mapbox-streets-v6/{z}/{x}/{y}.vector.pbf?access_token=pk.eyJ1IjoiYWhvY2V2YXIiLCJhIjoiY2t0cGdwMHVnMGdlbzMxbDhwazBic2xrNSJ9.WbcTL9uj8JPAsnT9mgb7oQ"}),style:createMapboxStreetsV6Style(x.Ay,I.A,w.A,O.A,F.A)})],target:"map",view:new i.Ay({center:[0,0],zoom:2})})}},function(e){var t;t=30867,e(e.s=t)}]);
//# sourceMappingURL=webgl-vector-tiles.js.map